---
alwaysApply: true
---
# Project Execution Rules (Repo-Local, Python)

Commands (Python):
- Format: `black .`
- Lint: `ruff check .`
- Types: `mypy .`
- Unit: `pytest -q`
- Integration: `pytest -q tests/acceptance` (or another folder)
- Coverage: `pytest --cov=src --cov-report=term-missing --cov-fail-under=85`
- Build (pkg): `python -m build`  
- Security: `pip-audit` (and optionally `bandit -r src -ll`)

Acceptance Criteria & Budgets (examples):
- API p95 ≤ 200ms @ 100 RPS (local).
- Parser p95 < 150ms on Apple M1 Max (local benchmark).
- Coverage (changed files): lines ≥ 85%, branches ≥ 75% (enforced via fail-under & review).

CI Gates (must pass before merge):
- black --check, ruff, mypy, pytest (unit + acceptance), coverage ≥ threshold, build, pip-audit

Background Worker Defaults:
- WIP limits: builder=3, tester=2, integrator=1 (tune in `.oodatcaa/work/SPRINT_QUEUE.json`)
- Lease TTLs: planner=30m, builder=90m, tester=45m, refiner=45m, integrator=30m
- Heartbeat interval: 1m (Negotiator checks every minute)
- Locks expire after 5m (may be broken with log note)

Log Rotation Policy:
- Threshold: 1,000 lines per log file (AGENT_LOG.md, SPRINT_LOG.md, SPRINT_PLAN.md)
- During sprint: When threshold exceeded, archive oldest 50-60% to `.oodatcaa/work/archive/sprint_N/FILENAME_archive_NNN.md`
- Sprint completion: Integrator archives ALL logs to `archive/sprint_N/` with `_final` suffix, starts new sprint with fresh logs
- AGENT_REPORTS.md: Never archived (permanent index)
- Archive documentation: See `.oodatcaa/work/archive/README.md`

Start-Over Gate (trigger when):
- Fundamental ACs unmet after two Adapt loops
- Architectural dead-end (Planner+Refiner agree)
- Scope creep beyond sprint plan

